<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>VersionMojo.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Release Candidate</a> &gt; <a href="index.source.html" class="el_package">com.smartcodeltd</a> &gt; <span class="el_source">VersionMojo.java</span></div><h1>VersionMojo.java</h1><pre class="source lang-java linenums">package com.smartcodeltd;

import com.smartcodeltd.domain.Version;
import com.smartcodeltd.writer.Writer;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugins.annotations.Mojo;
import org.apache.maven.plugins.annotations.Parameter;

import java.io.File;
import java.io.IOException;
import java.net.URI;

import static com.google.common.base.Preconditions.checkNotNull;
import static org.apache.maven.plugins.annotations.LifecyclePhase.PACKAGE;

/**
 * Retrieves project version specified in &lt;code&gt;pom.xml&lt;/code&gt; and outputs it
 * either to stdout or to a file, depending on &lt;a href=&quot;/version-mojo.html&quot;&gt;configuration&lt;/a&gt;.
 */
@Mojo(name = &quot;version&quot;, requiresProject = true, defaultPhase = PACKAGE)
<span class="fc" id="L21">public class VersionMojo</span>
    extends ReleaseCandidateMojo
{
    private final static String default_output_uri      = &quot;stdout&quot;;
    private final static String default_output_template = &quot;{{ version }}&quot;;

    /**
     * &lt;p&gt;
     * Defines where to direct the output of &lt;code&gt;release-candidate:version&lt;/code&gt;
     * &lt;/p&gt;
     *
     * &lt;ul&gt;
     * &lt;li&gt;Setting outputUri to &lt;code&gt;stdout&lt;/code&gt; will print output to the console,&lt;/li&gt;
     * &lt;li&gt;using &lt;code&gt;file://${project.basedir}/project.properties&lt;/code&gt; will direct the output to a &lt;code&gt;project.properties&lt;/code&gt; file for example.&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * &lt;p&gt;
     * &lt;strong&gt;Please note&lt;/strong&gt; that you should use an absolute path when specifying the &lt;code&gt;outputUri&lt;/code&gt;.
     * You can get hold of your project base directory by using &lt;code&gt;${project.basedir}&lt;/code&gt; as per the example above.
     * &lt;/p&gt;
     */
    @Parameter(defaultValue = default_output_uri, required = false, property = &quot;outputUri&quot;)
    private URI outputUri;

    /**
     * &lt;p&gt;
     * Defines how to structure the output of &lt;code&gt;release-candidate:version&lt;/code&gt;
     * &lt;/p&gt;
     *
     * &lt;p&gt;
     * If your build server of choice understands text output produced by maven (which is the case if you're using
     * TeamCity for example), you can specify the &lt;code&gt;outputTemplate&lt;/code&gt; as:
     * &lt;/p&gt;
     *
     * &lt;pre&gt;&amp;lt;outputTemplate&amp;gt;
     *  ##teamcity[setParameter name='env.PROJECT_VERSION' value='{{ version }}']
     *  ##teamcity[message text='Project version: {{ version }}']
     * &amp;lt;/outputTemplate&amp;gt;&lt;/pre&gt;
     *
     * &lt;p&gt;
     * If your build server prefers to use env variables defined using property files (Jenkins with EnvInject plugin)
     * you can specify the &lt;code&gt;outputTemplate&lt;/code&gt; as:
     * &lt;/p&gt;
     *
     * &lt;pre&gt;&amp;lt;outputTemplate&amp;gt;PROJECT_VERSION={{ version }}&amp;lt;/outputTemplate&amp;gt;&lt;/pre&gt;
     *
     * &lt;p&gt;
     * &lt;strong&gt;Please note&lt;/strong&gt; that when using multi-line templates, leading whitespace characters will be stripped.
     * &lt;/p&gt;
     */
    @Parameter(defaultValue = default_output_template, required = false, property = &quot;outputTemplate&quot;)
    protected String outputTemplate;

    @Override
    public void execute()
        throws MojoExecutionException
    {
<span class="fc" id="L78">        File pom = project.getFile();</span>

        try {
<span class="fc" id="L81">            Version version = currentVersionFrom(project.getFile());</span>

<span class="fc" id="L83">            info(&quot;Detected version: '%s'&quot;, version);</span>

<span class="fc" id="L85">            Writer.from(outputUri, charset).</span>
                    write(version.formattedWith(outputTemplate));
        }
<span class="nc" id="L88">        catch (Exception e) {</span>
<span class="nc" id="L89">            throw new MojoExecutionException(String.format(&quot;Couldn't read project version from '%s'.&quot;, pom.getPath()), e);</span>
<span class="fc" id="L90">        }</span>
<span class="fc" id="L91">    }</span>

    private Version currentVersionFrom(File pom) throws IOException {
<span class="fc" id="L94">        return new Version(checkNotNull(parsed(pom).getChild(&quot;project/version&quot;)).getText());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>